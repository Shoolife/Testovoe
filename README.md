
# Аудиосервис с авторизацией через Яндекс и загрузкой файлов

Проект представляет собой сервис для загрузки аудиофайлов с авторизацией через аккаунт Яндекса. Он использует FastAPI, SQLAlchemy, PostgreSQL, Docker для контейнеризации.

## Функциональность

- **Авторизация через Яндекс:** пользователи могут войти в сервис через аккаунт Яндекса.
- **Загрузка и управление аудиофайлами:** пользователи могут загружать файлы, а также изменять название загруженных файлов.
- **Админ-панель:** доступ к админской панели для управления пользователями (удаление пользователей).

## Стек технологий

- **Backend:** FastAPI, SQLAlchemy
- **База данных:** PostgreSQL 16
- **Авторизация:** Яндекс OAuth
- **Docker:** для контейнеризации и управления сервисом

## Требования

- Docker
- Docker Compose
- Python 3.9 и выше
- PostgreSQL 16

## Развертывание проекта

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/Shoolife/Testovoe.git
   ```

2. Создайте файл `.env` в корне проекта со следующими данными:

   ```
   YANDEX_CLIENT_ID=your_yandex_client_id
   YANDEX_CLIENT_SECRET=your_yandex_client_secret
   YANDEX_REDIRECT_URI=http://localhost:8000/auth/callback

   JWT_SECRET_KEY=1a4ebafc5a595aa4b0f11cd7281391c1157a5c064a2952a0c6959a1ce9756300
   JWT_ALGORITHM=HS256

   DATABASE_URL=postgresql+asyncpg://postgres:postgres@db:5432/audio

   ADMIN_LOGIN=admin
   ADMIN_PASSWORD=admin123
   ```

   - `YANDEX_CLIENT_ID`, `YANDEX_CLIENT_SECRET`, `YANDEX_REDIRECT_URI` — параметры для авторизации через Яндекс.
   - `JWT_SECRET_KEY`, `JWT_ALGORITHM` — секретный ключ для генерации JWT токенов.
   - `DATABASE_URL` — строка подключения к базе данных PostgreSQL.
   - `ADMIN_LOGIN` — логин для входа в админскую панель.
   - `ADMIN_PASSWORD` — пароль для входа в админскую панель.

3. Запустите Docker Compose для создания и запуска контейнеров:

   ```bash
   docker-compose up --build
   ```

4. После успешного запуска сервиса, API будет доступен по адресу [http://localhost:8000](http://localhost:8000).

## API

### Авторизация через Яндекс

1. Нажмите накнопку Войти через Яндекс, чтобы начать авторизацию через Яндекс.
2. После успешной авторизации, вы будете перенаправлены на страницу профиля с токеном доступа.

### Загрузка аудиофайлов

1. Перейдите на страницу профиля, где можно загрузить новый аудиофайл.
2. Введите имя файла (если нужно изменить название) и выберите файл для загрузки.
3. Загрузите файл с помощью формы на странице профиля.

### Админская панель

1. Нажмите на кнопку Админская панель для входа в админскую панель, используя логин и пароль администратора.
   - Логин: `admin`
   - Пароль: `admin123`
2. После входа в админскую панель, вы сможете увидеть список пользователей и удалять их.

### Обновление токена

Токен обновляется автоматически каждые 15 минут с использованием запроса на `/auth/refresh`.

## Структура проекта

```
.
├── app/
│   ├── api/
│   │   ├── auth.py
│   │   ├── files.py
│   │   ├── users.py
│   │   └── admin.py
│   ├── db/
│   │   ├── models.py
│   │   ├── session.py
│   ├── core/
│   │   ├── security.py
│   │   ├── config.py
│   ├── schemas/
│   │   ├── file.py
│   │   ├── user.py
│   │   ├── token.py
│   ├── services/
│   │   ├── yandex_oauth.py
├── docker-compose.yml
├── Dockerfile
├── .env
└── README.md
```

## Документация

Документация API доступна по адресу:

- **Swagger UI**: [http://localhost:8000/docs](http://localhost:8000/docs)
- **ReDoc**: [http://localhost:8000/redoc](http://localhost:8000/redoc)

